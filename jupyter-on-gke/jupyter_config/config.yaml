# This file can update the JupyterHub Helm chart's default configuration values.
#
# For reference see the configuration reference and default values, but make
# sure to refer to the Helm chart version of interest to you!
#
# Introduction to YAML:     https://www.youtube.com/watch?v=cdLNKUoMc6c
# Chart config reference:   https://zero-to-jupyterhub.readthedocs.io/en/stable/resources/reference.html
# Chart default values:     https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/HEAD/jupyterhub/values.yaml
# Available chart versions: https://jupyterhub.github.io/helm-chart/
hub:
  config:
    Authenticator:
      admin_users:
        - user1
        - user2
      allowed_users:
        - user3
        - user4
    # ...
    DummyAuthenticator:
      password: password
    JupyterHub:
      authenticator_class: dummy
  networkPolicy:
    enabled: false

prePuller:
  hook:
    enabled: false

proxy:
  chp:
    networkPolicy:
      enabled: false
  traefik:
    networkPolicy:
      enabled: false

scheduling:
  userScheduler:
    enabled: false

singleuser:
  cpu:
    limit: .5
    guarantee: .5
  memory:
    limit: 1G
    guarantee: 1G
  nodeSelector:
    iam.gke.io/gke-metadata-server-enabled: "true"
  image:
    name: jupyter/tensorflow-notebook
    tag: python-3.10
  startTimeout: 1000
  extraAnnotations:
    gke-gcsfuse/volumes: "true"
  serviceAccountName: jup-sa
  storage:
    # homeMountPath: /home/jovyan
    dynamic:
      storageClass: filestore-storage-class
      pvcNameTemplate: claim-{username}
      volumeNameTemplate: volume-{username}
# More info on kubespawner overrides: https://jupyterhub-kubespawner.readthedocs.io/en/latest/spawner.html#kubespawner.KubeSpawner
#   profile example:
#   - display_name: "Learning Data Science"
#      description: "Datascience Environment with Sample Notebooks"
#      kubespawner_override:
#           cpu_limit: .5
#           cpu_guarantee: .5
#           mem_limit: 1G
#           mem_guarantee: 1G
#        image: jupyter/datascience-notebook:2343e33dec46
#        lifecycle_hooks:
#          postStart:
#            exec:
#              command:
#                - "sh"
#                - "-c"
#                - >
#                  gitpuller https://github.com/data-8/materials-fa17 master materials-fa;
  profileList:
    - display_name: "Basic"
      description: "Creates CPU VMs as the compute for notebook execution."
      default: true
    - display_name: "Test Persistant Volumes"
      description: "Testing shared persistant volumes that uses GCSFuse"
      kubespawner_override:
        http_timeout: 1000
        volume_mounts:
        - name: gcs-fuse-csi-static
          mountPath: /home/{username}
        volumes:
        - name: gcs-fuse-csi-static
          persistentVolumeClaim:
            claimName: gcs-fuse-csi-static-pvc
    - display_name: "GPU T4"
      description: "Creates GPU VMs (T4) as the compute for notebook execution"
      kubespawner_override:
        image: jupyter/tensorflow-notebook:python-3.10
        # volume_mounts:
        # - name: pvc-4f9bad7e-0a2c-4e9a-b7a4-ba211e0a7692
        #   mountPath: /home/jovyan
        # volumes:
        # - name: pvc-4f9bad7e-0a2c-4e9a-b7a4-ba211e0a7692
        #   persistentVolumeClaim:
        #     claimName: gcs-fuse-csi-static-pvc
        extra_resource_limits:
          # number of gpus needed on the node
          nvidia.com/gpu: "2"
      #  possible values: nvidia-tesla-k80, nvidia-tesla-p100, nvidia-tesla-p4, nvidia-tesla-v100, nvidia-tesla-t4, nvidia-tesla-a100, nvidia-a100-80gb, nvidia-l4
        node_selector:
          cloud.google.com/gke-accelerator: "nvidia-tesla-t4"
    - display_name: "GPU A100"
      description: "Creates GPU VMs (A100) as the compute for notebook execution"
      kubespawner_override:
        image: jupyter/tensorflow-notebook:python-3.10
        extra_resource_limits:
          nvidia.com/gpu: "2"
        # GPU requests 
        extra_resource_guarantees:
          nvidia.com/gpu: "2"
        node_selector:
          cloud.google.com/gke-accelerator: "nvidia-tesla-a100"
  cmd: null
  cloudMetadata:
    blockWithIptables: false
  networkPolicy:
    enabled: false
